<html id="secretLang">

<head>
  <link href='../../public/styles/secret.css' rel="stylesheet">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>

<body>
  <script src="/pages/lib/jquery.js"></script>
  <script src="/pages/js/ajax.js"></script>
  <script src="/pages/lib/socket.js"></script>
  <input type="image" id="backButton" onclick='AjaxCall("disable", "/")' src="../../public/images/backButton.png" />

  <div id="text"></div>
  <div id="subtext"></div>

  <span id="countdown">0</span>
  <div class="content_box">
    <div class="circle">
      <div class="box">
      </div>
    </div>
    <div class="background_box b1">
      <div class="background c1">

      </div>
    </div>
    <div class="background_box b2">
      <div class="background c2">

      </div>
    </div>
    <div class="background_box b3">
      <div class="background c3">

      </div>
    </div>
    <div class="background_box b4">
      <div class="background c4">

      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      const socket = io('http://localhost:3000');
      $("#recognizing").hide()
      $("#countdown").hide()
      $(".content_box").hide()

      document.getElementById('text').innerHTML = "First, we need to collect ambient noise.";
      document.getElementById('subtext').innerHTML = "It will take 20 seconds. Keep silent to reduce noise while recording.";

      //collect ambient noise
      socket.on("secret_bg", async (msg) => {

        await new Promise((resolve) => {
            var seconds = document.getElementById("countdown").textContent;
            $("#recognizing").show()
            $("#countdown").show()
            $(".content_box").show()
            var countdown = setInterval(function () {
              seconds++;
              document.getElementById("countdown").textContent = seconds + "%";
              if (seconds == 100) {
                clearInterval(countdown)
                resolve()
              };
            }, (msg.time ? msg.time : 2000)/100);
          })

        window.location.href = "./secretCount.html";
      })

    })
  </script>

</body>

</html>